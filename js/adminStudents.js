$(document).ready(function() {
    function loadStudentData() {
        $.ajax({
            url: 'admin_students_data.php',
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                const tableBody = $('#employeeTable tbody');
                tableBody.empty(); // Очищаем таблицу перед заполнением
                
                data.students.forEach(function(student) {
                    const budgetStatus = student.budget_status.trim().toLowerCase() === 'да' ? 'Да' : 'Нет';
                    const budgetClass = budgetStatus === 'Да' ? 'yes_green' : 'no_red';
                    
                    // Форматируем дату рождения
                    const birthday = new Date(student.birthday);
                    const formattedDate = birthday.getDate().toString().padStart(2, '0') + '.' +
                                          (birthday.getMonth() + 1).toString().padStart(2, '0') + '.' +
                                          birthday.getFullYear();

                    const row = `
                        <tr>
                            <td>${student.last_name} ${student.name}</td>
                            <td class="${student.class === 'Старший' ? 'older_red' : (student.class === 'Средний' ? 'average_orange' : 'junior_green')}">${student.class}</td>
                            <td>${student.class_teacher}</td>
                            <td>${formattedDate}</td>
                            <td class="${budgetClass}">${budgetStatus}</td>
                            <td class="btns_td">
                                <button class="archive-btn"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M16.6665 18.9583H3.33317C2.72552 18.9579 2.14288 18.7163 1.71321 18.2866C1.28353 17.8569 1.04195 17.2743 1.0415 16.6666V6.66663C1.0415 6.50087 1.10735 6.34189 1.22456 6.22468C1.34177 6.10747 1.50074 6.04163 1.6665 6.04163H18.3332C18.4989 6.04163 18.6579 6.10747 18.7751 6.22468C18.8923 6.34189 18.9582 6.50087 18.9582 6.66663V16.6666C18.9577 17.2743 18.7161 17.8569 18.2865 18.2866C17.8568 18.7163 17.2742 18.9579 16.6665 18.9583ZM2.2915 7.29163V16.6666C2.29194 16.9428 2.40183 17.2075 2.59709 17.4027C2.79234 17.598 3.05704 17.7079 3.33317 17.7083H16.6665C16.9426 17.7079 17.2073 17.598 17.4026 17.4027C17.5978 17.2075 17.7077 16.9428 17.7082 16.6666V7.29163H2.2915Z" fill="white"/>
                                        <path d="M18.3332 7.29164H1.66648C1.55998 7.29163 1.45525 7.26441 1.36222 7.21256C1.26919 7.16071 1.19096 7.08595 1.13494 6.99537C1.07893 6.90479 1.04698 6.8014 1.04215 6.69501C1.03731 6.58862 1.05975 6.48276 1.10732 6.38747L3.37732 1.84747C3.49769 1.60471 3.68368 1.40054 3.9142 1.2581C4.14471 1.11567 4.41052 1.04068 4.68148 1.04164H15.3182C15.5892 1.04066 15.8551 1.11574 16.0857 1.25833C16.3162 1.40093 16.5021 1.60532 16.6223 1.8483L18.8923 6.38747C18.9399 6.48276 18.9623 6.58862 18.9575 6.69501C18.9526 6.8014 18.9207 6.90479 18.8647 6.99537C18.8087 7.08595 18.7304 7.16071 18.6374 7.21256C18.5444 7.26441 18.4397 7.29163 18.3332 7.29164ZM2.67815 6.04164H17.3215L15.504 2.40664C15.4869 2.37195 15.4605 2.34277 15.4276 2.32244C15.3947 2.3021 15.3568 2.29142 15.3182 2.29164H4.68148C4.64296 2.29154 4.60518 2.30217 4.57236 2.32233C4.53954 2.3425 4.51298 2.3714 4.49565 2.4058L2.67815 6.04164Z" fill="white"/>
                                        <path d="M10 15.625C9.83424 15.625 9.67527 15.5592 9.55806 15.4419C9.44085 15.3247 9.375 15.1658 9.375 15V10C9.375 9.83424 9.44085 9.67527 9.55806 9.55806C9.67527 9.44085 9.83424 9.375 10 9.375C10.1658 9.375 10.3247 9.44085 10.4419 9.55806C10.5592 9.67527 10.625 9.83424 10.625 10V15C10.625 15.1658 10.5592 15.3247 10.4419 15.4419C10.3247 15.5592 10.1658 15.625 10 15.625Z" fill="white"/>
                                        <path d="M10 15.6249C9.91795 15.6251 9.83663 15.609 9.76081 15.5775C9.685 15.5461 9.61618 15.4999 9.55837 15.4416L7.05837 12.9416C6.94797 12.8231 6.88787 12.6664 6.89072 12.5045C6.89358 12.3426 6.95917 12.1881 7.07368 12.0736C7.18819 11.9591 7.34268 11.8935 7.5046 11.8906C7.66652 11.8877 7.82322 11.9478 7.9417 12.0582L10 14.1157L12.0584 12.0582C12.1768 11.9478 12.3336 11.8877 12.4955 11.8906C12.6574 11.8935 12.8119 11.9591 12.9264 12.0736C13.0409 12.1881 13.1065 12.3426 13.1093 12.5045C13.1122 12.6664 13.0521 12.8231 12.9417 12.9416L10.4417 15.4416C10.3839 15.4999 10.3151 15.5461 10.2393 15.5775C10.1634 15.609 10.0821 15.6251 10 15.6249Z" fill="white"/>
                                    </svg>  Отправить в архив</button>
                                <button class="edit-btn">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_103_117)">
                                            <path d="M0.576375 18C0.42684 18 0.280241 17.9413 0.171934 17.8322C0.0299463 17.6902 -0.0273518 17.4841 0.0215612 17.2895L1.09611 12.9765C1.12127 12.8758 1.17325 12.7834 1.24648 12.7102L13.3429 0.613684C14.1611 -0.204561 15.4929 -0.204561 16.3111 0.613684L17.3903 1.69284C18.2085 2.51109 18.2085 3.84292 17.3903 4.66103L5.29396 16.7575C5.22059 16.8307 5.12822 16.8834 5.0276 16.9079L0.714589 17.9824C0.66875 17.9947 0.622912 18 0.576375 18ZM2.16772 13.407L1.36178 16.6415L4.59632 15.8356L16.5813 3.85131C16.953 3.47957 16.953 2.8736 16.5813 2.50187L15.5021 1.4227C15.1297 1.05027 14.5236 1.05097 14.1527 1.4227L2.16772 13.407Z" fill="white"/>
                                            <path d="M15.1247 6.69052C14.9781 6.69052 14.8315 6.63476 14.7201 6.52268L11.4818 3.28506C11.258 3.06131 11.258 2.6988 11.4818 2.4752C11.7054 2.25159 12.0679 2.25159 12.2915 2.4752L15.53 5.71366C15.7536 5.93726 15.7536 6.29977 15.53 6.52338C15.4169 6.63476 15.2704 6.69052 15.1247 6.69052Z" fill="white"/>
                                            <path d="M4.8897 16.9255C4.74311 16.9255 4.59665 16.8697 4.48526 16.7575L1.2468 13.5192C1.0232 13.2954 1.0232 12.9329 1.2468 12.7093C1.47041 12.4857 1.83292 12.4857 2.05666 12.7093L5.29498 15.9478C5.51859 16.1714 5.51859 16.5339 5.29498 16.7575C5.18276 16.8697 5.0363 16.9255 4.8897 16.9255Z" fill="white"/>
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_103_117">
                                                <rect width="18" height="18" fill="white"/>
                                            </clipPath>
                                        </defs>
                                    </svg>Редактировать</button>
                            </td>
                        </tr>
                    `;
                    tableBody.append(row);
                });
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Ошибка при загрузке данных: ' + textStatus, errorThrown);
            }
        });
    }

    // Загружаем данные при загрузке страницы
    loadStudentData();

    // Можно добавить функционал поиска и фильтрации данных здесь
});
